<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://hf.tranzila.com/assets/js/thostedf.js"></script>
    
    <style>
        body { font-family: sans-serif; margin: 0; padding: 10px; }
        .form-control { border: 1px solid #ced4da; padding: 12px; border-radius: 4px; height: 45px; background: white; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; }
        #status { font-size: 12px; color: #666; margin-top: 5px; }
    </style>
</head>
<body>

    <div>
        <label>Credit Card Details</label>
        <div class="form-control" id="credit_card_number"></div>
        <div id="status">Loading secure fields...</div>
    </div>

    <script>
        var hostedFields;

        // Check if the Tranzila library loaded correctly
        window.onload = function() {
            if (typeof TzlaHostedFields !== 'undefined') {
                document.getElementById('status').innerText = "Tranzila Library Loaded. Initializing...";
                
                try {
                    hostedFields = TzlaHostedFields.create({
                        sandbox: false,
                        fields: {
                            credit_card_number: { selector: '#credit_card_number' }
                        }
                    });
                    document.getElementById('status').innerText = "Ready.";
                } catch (e) {
                    document.getElementById('status').innerText = "Error: " + e.message;
                }
            } else {
                document.getElementById('status').innerText = "Error: Tranzila library blocked. Please whitelist this domain.";
            }
        };

        // Jotform Submit Logic
        JFCustomWidget.subscribe("submit", function() {
            if (!hostedFields) {
                JFCustomWidget.sendSubmit({ valid: false });
                return;
            }

            hostedFields.charge({
                terminal_name: 'toratshraga',
                tranmode: 'V', // Verify
                tranzilaTK: '1' // Tokenize
            }, function(err, response) {
                if (err) {
                    alert("Card validation failed.");
                    JFCustomWidget.sendSubmit({ valid: false });
                } else if (response && response.TranzilaTK) {
                    // This sends the token to your Jotform submission
                    JFCustomWidget.sendSubmit({
                        valid: true,
                        value: response.TranzilaTK
                    });
                }
            });
        });
    </script>
</body>
</html>
