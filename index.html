<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; }
        #tranzila-frame { width: 100%; height: 600px; border: none; }
    </style>
</head>
<body>

    <form id="tranzila-form" action="https://direct.tranzila.com/toratshraga/iframenew.php" method="POST" target="tranzila-frame">
        <input type="hidden" name="sum" value="1"> 
        <input type="hidden" name="currency" value="1"> 
        <input type="hidden" name="tranmode" value="VK"> <input type="hidden" name="contact" id="contact_name" value="Student Registration">
        
        <input type="hidden" name="nologo" value="1">
        <input type="hidden" name="hidesum" value="1">
    </form>

    <iframe name="tranzila-frame" id="tranzila-frame"></iframe>

    <script>
        // 1. Get student name from Jotform if available
        JFCustomWidget.subscribe("ready", function(data) {
            // If you pass the name via Jotform field, we can grab it here
            // For now, it defaults to "Student Registration"
            document.getElementById('tranzila-form').submit();
        });

        // 2. Listen for the token response
        window.addEventListener("message", function(event) {
            // Tranzila sends the result back via postMessage
            if (event.data) {
                var res = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
                
                if (res.TranzilaTK) {
                    // Success: Send token to Jotform
                    JFCustomWidget.sendData({ value: res.TranzilaTK });
                    // Tell Jotform the field is valid
                    JFCustomWidget.sendSubmit({ valid: true });
                }
            }
        }, false);
    </script>
</body>
</html>
