<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://hf.tranzila.com/assets/js/thostedf.js"></script>
    
    <style>
        body { font-family: sans-serif; margin: 0; padding: 10px; }
        .form-control { border: 1px solid #ced4da; padding: 12px; border-radius: 4px; height: 45px; background: white; margin-bottom: 10px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; }
        .error_message { color: #d9534f; font-size: 13px; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="col-md-4 mb-3">
        <label for="credit_card_number">Card Information</label>
        <div class="form-control" id="credit_card_number"></div>
        <div id="errors_for_number" class="error_message"></div>
    </div>

    <script>
        // Initialize the fields once the page is ready
        var fields;
        
        // Wait for Tranzila library to load
        window.onload = function() {
            if (typeof TzlaHostedFields !== 'undefined') {
                fields = TzlaHostedFields.create({
                    sandbox: false, // Mandatory per docs
                    fields: {
                        credit_card_number: { selector: '#credit_card_number' }
                    }
                });
            }
        };

        // Handle Jotform Submit
        JFCustomWidget.subscribe("submit", function() {
            fields.charge({
                terminal_name: 'toratshraga',
                tranmode: 'V', // Verify mode for tokenization
                tranzilaTK: '1' // Request permanent token
            }, function(err, response) {
                if (err) {
                    document.getElementById('errors_for_number').innerText = "Invalid Card Details";
                    JFCustomWidget.sendSubmit({ valid: false });
                } else if (response && response.TranzilaTK) {
                    // Send token to Jotform
                    JFCustomWidget.sendSubmit({
                        valid: true,
                        value: response.TranzilaTK
                    });
                }
            });
        });
    </script>
</body>
</html>
